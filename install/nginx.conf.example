map $remote_addr $allowed_ip {
# Enter the IPs that you want to have access to the backend. 1 after the IP will allow access
# and 0 will deny access(if for example the default value is 1 )

	# 1.2.3.4 1;

	#change the default value below to 0, to enable the IP restrictions for the site backend
	default 1;
}

server {
	listen   80;
	listen   [::]:80 ipv6only=on;

	server_name .info.opendata.obshtestvo.bg .wordpress.opendata.obshtestvo.bg;

	root /var/www/wordpress;
	index index.php index.html index.htm;

	location / {
		# First attempt to serve request as file, then
		# as directory, then fall back to displaying a 404.
		try_files $uri $uri/ /index.php?$args;
	}

	# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
	location ~ \.php$ {
		fastcgi_split_path_info ^(.+\.php)(/.+)$;
		# NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini

		# With php5-fpm:
		fastcgi_pass unix:/var/run/php5-fpm.sock;
		fastcgi_index index.php;
		include fastcgi_params;
	}

	# Check the allowed IPs and deny access to everyone else, accordingly.
	set $check '';

	if ( $allowed_ip = 0 ) {
		set $check "A";
	}

	if ( $request_uri ~ ^/wp-login\.php ) {
		set $check "${check}B";
	}

	if ( $check = "AB" ) {
		return 403;
	}

	location = /favicon.ico {
		log_not_found off;
		access_log off;
	}

	location = /robots.txt {
		allow all;
		log_not_found off;
		access_log off;
	}

	# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).
	# Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)
	location ~ /\. {
		deny all;
	}

	# Deny access to any files with a .php extension in the uploads directory
	# Works in sub-directory installs and also in multisite network
	# Keep logging the requests to parse later (or to pass to firewall utilities such as fail2ban)
	location ~* /(?:uploads|files)/.*\.php$ {
		deny all;
	}
}
